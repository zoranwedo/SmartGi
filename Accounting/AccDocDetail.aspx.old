<%@ Page Title="" Language="VB" MasterPageFile="~/Accounting/masterAccounting.master"
    AutoEventWireup="false" EnableEventValidation="false" CodeFile="AccDocDetail.aspx.vb" 
    Inherits="Accounting_AccDocDetail" %>

<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="asp" %>
<%@ MasterType VirtualPath="~/Accounting/masterAccounting.master" %>
<asp:Content ID="Content1" ContentPlaceHolderID="title" runat="Server">
    Accounting Document Detail
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="AccountContent" runat="Server">
    <script type="text/javascript">
        function checkMaxLen(txt, maxLen) {
            try {
                if (txt.value.length > (maxLen - 1)) {
                    var cont = txt.value;
                    txt.value = cont.substring(0, (maxLen - 1));
                    return false;
                };
            } catch (e) {
            }
        }
    </script>
    
    <%--<asp:UpdatePanel runat="server" ID="pnlMain" UpdateMode="Conditional">
        <ContentTemplate>--%>

    <asp:HiddenField ID="hfLocal" runat="server" />
    <table cellpadding="0" cellspacing="2" style="width: 493px;">
        <tr>
            <td class="GridLabelBG">
                <asp:Label ID="lbDetails" runat="server" Text="Document details" SkinID="skGridLabel"></asp:Label>
            </td>
        </tr>
        <tr>
            <td class="GridBorder" valign="top">
                <table cellpadding="0" cellspacing="2">
                    <tr>
                        <td colspan="2" style="padding-bottom: 5px;">
                            <asp:HiddenField ID="hfShwPayMode" runat="server" />
                            <asp:HiddenField ID="hfCanEdit" runat="server" />
                            <asp:HiddenField ID="hfCanModify" runat="server" />
                            <asp:HiddenField ID="hfCanApply" runat="server" />
                            <asp:HiddenField ID="hfUser" runat="server" />
                            <asp:FormView ID="fvDocDetail" runat="server" DataKeyNames="DocumentID" DataSourceID="dsAccTransDoc">
                                <InsertItemTemplate>
                                    <table cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td style="width: 100px; padding-right: 20px; text-align: right;">
                                                Date
                                            </td>
                                            <td style="width: 400px">
                                                <asp:TextBox ID="txtReference0" runat="server" CssClass="TextBox" />
                                                <asp:CalendarExtender ID="txtReference0_CalendarExtender" runat="server" CssClass="cal_Theme1"
                                                    Enabled="True" TargetControlID="txtReference0" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 113px; padding-right: 20px; text-align: right;">
                                                Reference
                                            </td>
                                            <td style="width: 330px">
                                                <asp:TextBox ID="txtReference" runat="server" CssClass="TextBox" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 113px; padding-right: 20px; text-align: right;">
                                                <asp:Label ID="lblPayMode" runat="server" Text="Pay Mode" />
                                            </td>
                                            <td style="width: 330px">
                                                <asp:DropDownList ID="ddlPayMode" runat="server" AutoPostBack="True" BackColor="White"
                                                    CssClass="TextBox" DataSourceID="dsPayMode" DataTextField="PayModeID" DataValueField="PayModeID" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 113px; padding-right: 20px; text-align: right;">
                                                <asp:Label ID="lblHPercent1" runat="server" Text="Amount" Visible="<%# Not cbHotel.Checked %>" />
                                            </td>
                                            <td style="width: 330px">
                                                <asp:TextBox ID="txtAmount" runat="server" CssClass="TextBox" Visible="<%# Not cbHotel.Checked %>" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 113px; padding-right: 20px; text-align: right;">
                                                <asp:Label ID="lblBankCh" runat="server" Text="Bank Charge" />
                                            </td>
                                            <td style="width: 330px">
                                                <asp:TextBox ID="txtBankCharge" runat="server" CssClass="TextBox" Text='<%# Bind("BAmount", "{0:D}") %>' />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 113px; padding-right: 20px; text-align: right;">
                                                <asp:Label ID="lblHPercent" runat="server" Text="Hotel %" Visible="False" />
                                            </td>
                                            <td style="width: 330px">
                                                <asp:TextBox ID="txtHPercent" runat="server" CssClass="TextBox" Text='<%# Bind("HPercent") %>' Visible="False" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 113px; padding-right: 20px; text-align: right;">
                                                <asp:Label ID="lblHPercent0" runat="server" Text="Hotel Amount" Visible="<%# cbHotel.Checked %>" />
                                            </td>
                                            <td style="width: 330px">
                                                <asp:TextBox ID="txtHAmount" runat="server" CssClass="TextBox" Text='<%# Bind("HAmount") %>' Visible="<%# cbHotel.Checked %>" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="GridRowClear" colspan="1" style="width: 113px; padding-right: 20px; text-align: right;">
                                                Note
                                            </td>
                                            <td style="width: 330px;">
                                                <asp:TextBox ID="txtNote" runat="server" CssClass="TextBox" TextMode="MultiLine"
                                                    MaxLength="2000" onkeyup="return checkMaxLen(this,2001)" />
                                                <asp:RegularExpressionValidator ID="RegularExpressionValidator1" runat="server" ControlToValidate="txtNote"
                                                    Display="Static" ErrorMessage="Not more than 2000 charcters" ValidationExpression="^[\s\S]{0,2000}$" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="right" class="GridRow1T" style="padding-left: 5px; width: 113px;">
                                                &nbsp;
                                            </td>
                                            <td align="right" class="GridRow1T" style="width: 330px">
                                                <asp:Button ID="Button2" runat="server" SkinID="skBtnBase" Text="Insert" CommandName="Insert" />&nbsp;
                                                <asp:Button ID="Button1" runat="server" SkinID="skBtnBase" Text="Cancel" CausesValidation="False" CommandName="Cancel" />
                                                &nbsp;&nbsp;
                                            </td>
                                            <td class="GridRowClear">
                                            </td>
                                        </tr>
                                    </table>
                                </InsertItemTemplate>
                                <EditItemTemplate>
                                    <table cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td class="GridRow1B" style="text-align: right; padding-right: 5px;">
                                                <b><asp:Label ID="lbDocument" runat="server" Text='<%# Eval("DocCode") %>' /></b>
                                            </td>
                                            <td class="GridRow1B" >
                                                <b><asp:Label ID="Label1" runat="server" Text='<%# Eval("DocNumber") %>' /></b>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 100px" class="SelectRow1B">
                                                Tour Operator
                                            </td>
                                            <td style="width: 400px" class="GridRow1B">
                                                <asp:DropDownList ID="ddlTO" runat="server" CssClass="TextBox" DataSourceID="dsTOAll"
                                                    DataTextField="TourOp" DataValueField="TourOpID" SelectedValue='<%# Bind("TourOpId") %>'
                                                    Enabled='<%# Me.CanEdit()%>' >
                                                    <%--*** Local
                                                    AutoPostBack="true" OnDataBound="ddlTO_DataBound" OnSelectedIndexChanged="ddlTO_DataBound" >--%>
                                                    <asp:ListItem Selected="True">-</asp:ListItem>
                                                </asp:DropDownList>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Department
                                            </td>
                                            <td class="GridRow1B" >
                                                <asp:DropDownList ID="ddlDep" runat="server" BackColor="White" CssClass="TextBox" />
                                                <asp:CascadingDropDown ID="exDep" runat="server" 
                                                    TargetControlID="ddlDep" Category="DepID" 
                                                    ServicePath="~/DepEmp.asmx"
                                                    ServiceMethod="GetDepID"
                                                    SelectedValue='<%# Bind("DepID") %>' >
                                                </asp:CascadingDropDown>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Employee
                                            </td>
                                            <td class="GridRow1B" >
                                                <asp:DropDownList ID="ddlEmp" runat="server" BackColor="White" CssClass="TextBox" />
                                                <asp:CascadingDropDown ID="exEmp" runat="server" 
                                                    ParentControlID="ddlDep"
                                                    TargetControlID="ddlEmp" Category="EmpID" 
                                                    ServicePath="~/DepEmp.asmx"
                                                    ServiceMethod="GetEmpID"
                                                    SelectedValue='<%# Bind("EmpID") %>' >
                                                </asp:CascadingDropDown>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Date
                                            </td>
                                            <td class="GridRow1B" >
                                                <asp:TextBox ID="txtDate" runat="server" CssClass="TextBox" Text='<%# Bind("DocDate","{0:d}") %>' Enabled='<%# Me.CanEdit()%>' />
                                                <asp:CalendarExtender ID="txtDate_CalendarExtender" runat="server" CssClass="cal_Theme1"
                                                    Enabled="True" TargetControlID="txtDate" />
                                                <asp:CompareValidator ID="txtDate_CompareValidator" runat="server" ControlToValidate="txtDate"
                                                    Operator="DataTypeCheck" SkinID="skDate" Type="Date" />
                                                <asp:ValidatorCalloutExtender ID="txtDate_DateValidatorCalloutExtender" runat="server"
                                                    SkinID="skExtender" TargetControlID="txtDate_CompareValidator" />
                                                <asp:RequiredFieldValidator ID="txtDate_RequiredFieldValidator" runat="server" ControlToValidate="txtDate"
                                                    Display="None" ErrorMessage="Required Field" />
                                                <asp:ValidatorCalloutExtender ID="txtDate_ReqDateValidatorCalloutExtender" runat="server"
                                                    Enabled="True" TargetControlID="txtDate_RequiredFieldValidator" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Reference
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:TextBox ID="txtReference" runat="server" CssClass="TextBox" Text='<%# Bind("Reference") %>' />
                                            </td>
                                        </tr>
                                        <%--*** Local
                                        <asp:Panel ID="pnlInter" runat="server" >--%>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Amount
                                            </td>
                                            <td class="GridRow1B" >
                                                <asp:TextBox ID="txtIAmount" runat="server" CssClass="TextBox" Text='<%# Eval("Amount","{0:N2}") %>' Enabled='<%# Me.CanEdit()%>' />
                                                <asp:RequiredFieldValidator ID="reqIAmount" runat="server" Display="None" 
                                                    ControlToValidate="txtIAmount" ErrorMessage="Required field!" 
                                                    Enabled="True" />
                                                <asp:ValidatorCalloutExtender ID="reqIAmount_Callout" runat="server" TargetControlID="reqIAmount" />
                                                <asp:CompareValidator ID="valIAmount" runat="server" Display="None" 
                                                    ControlToValidate="txtIAmount" ErrorMessage="Not a valid amount" 
                                                    Operator="GreaterThan" Type="Currency" ValueToCompare="0" />
                                                <asp:ValidatorCalloutExtender ID="valIAmount_Callout" runat="server" TargetControlID="valIAmount" />
                                            </td>
                                        </tr>
                                        <%--*** Local
                                        </asp:Panel>
                                        <asp:Panel ID="pnlLocal" runat="server" >
                                        <tr>
                                            <td class="SelectRow1B">
                                                Amount
                                            </td>
                                            <td class="GridRow1B">
                                                <table cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width: 60px; text-align: center;">
                                                            <asp:DropDownList ID="ddlCurrencyFrom" runat="server" DataSourceID="dsCurrency" 
                                                                DataTextField="CurrencyID" DataValueField="CurrencyID" CssClass="TextBox" 
                                                                AppendDataBoundItems="true" AutoPostBack="true" CausesValidation="false"
                                                                Enabled='<%# Me.CanEdit()%>' 
                                                                onselectedindexchanged="ddlCurrencyFrom_SelectedIndexChanged" >
                                                                <asp:ListItem Text="USD" Value="" />
                                                            </asp:DropDownList>
                                                        </td>
                                                        <td style="width: 100px;">
                                                            <asp:TextBox ID="txtAmount" runat="server" CssClass="TextBox" Text='<%# Eval("Amount","{0:N2}") %>' Enabled='<%# Me.CanEdit()%>' />
                                                            <asp:RequiredFieldValidator ID="reqAmount" runat="server" Display="None" 
                                                                ControlToValidate="txtAmount" ErrorMessage="Required field!" 
                                                                Enabled="True" />
                                                            <asp:ValidatorCalloutExtender ID="reqAmount_Callout" runat="server" TargetControlID="reqAmount" />
                                                            <asp:CompareValidator ID="valAmount" runat="server" Display="None" 
                                                                ControlToValidate="txtAmount" ErrorMessage="Not a valid amount" 
                                                                Operator="GreaterThan" Type="Currency" ValueToCompare="0" />
                                                            <asp:ValidatorCalloutExtender ID="valAmount_Callout" runat="server" TargetControlID="valAmount" />
                                                        </td>
                                                        <td style="width: 80px; padding-left: 5px;">
                                                            <asp:Label ID="txtRateExch" runat="server" Font-Italic="true" />
                                                            <asp:Image ID="imgWarning" runat="server" ImageUrl="~/Images/Warning.gif" 
                                                                Visible="false" ToolTip="There are no valid exchange rate for document date!" />
                                                        </td>
                                                        <td style="width: 20px;">
                                                            <asp:ImageButton ID="ibExchange" runat="server" CausesValidation="true" 
                                                                ImageUrl="~/Images/ArtDown.gif" CssClass="ImgButton" Visible="false" 
                                                                onclick="ibExchange_Click" />
                                                        </td>
                                                        <td style="width: 80px; text-align: right;">
                                                            <asp:Label ID="lblRateExch" runat="server" Font-Italic="true" Font-Strikeout="true" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <asp:DropDownList ID="ddlCurrencyTo" runat="server" DataSourceID="dsCurrency" 
                                                                DataTextField="CurrencyID" DataValueField="CurrencyID" CssClass="TextBox" 
                                                                AppendDataBoundItems="true" AutoPostBack="true" CausesValidation="true" 
                                                                ondatabound="ddlCurrencyTo_DataBound" 
                                                                onselectedindexchanged="ddlCurrencyTo_SelectedIndexChanged" >
                                                                <asp:ListItem Text="N/A" Value="" />
                                                            </asp:DropDownList>
                                                        </td>
                                                        <td>
                                                            <asp:TextBox ID="txtAmountTo" runat="server" CssClass="TextBox" ReadOnly="true" />
                                                        </td>
                                                        <td colspan="2">&nbsp;</td>
                                                       <td style="text-align: right;">
                                                            <asp:Label ID="lblAmountTo" runat="server" Font-Strikeout="true" />
                                                        </td>
                                                    </tr>
                                                </table> 
                                                <asp:HiddenField ID="hfExchID" runat="server" />
                                                <asp:ObjectDataSource ID="dsCurrency" runat="server" 
                                                    OldValuesParameterFormatString="original_{0}" SelectMethod="GetData" 
                                                    TypeName="AccExchangeTableAdapters.AccCurrencyCodeTableAdapter">
                                                </asp:ObjectDataSource>
                                            </td>
                                        </tr>
                                        </asp:Panel>--%>
                                        <tr>
                                            <td class="SelectRow1B">
                                                <asp:Label ID="lblHPercent" runat="server" Text="Hotel %" />
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:TextBox ID="txtHPercent" runat="server" CssClass="TextBox" Text='<%# Bind("HPercent","{0:F2}") %>' Enabled="False" />
                                                <asp:CompareValidator ID="txtHPercent_CompareValidator" runat="server" ControlToValidate="txtHPercent"
                                                    Operator="DataTypeCheck" Type="Double" SkinID="skInteger" />
                                                <asp:ValidatorCalloutExtender ID="txtHPercent_ValidatorCalloutExtender" runat="server"
                                                    TargetControlID="txtHPercent_CompareValidator" SkinID="skExtender" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                <asp:Label ID="lblHPercent1" runat="server" Text="Hotel Amount" />
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:TextBox ID="lblHAmount" runat="server" CssClass="TextBox" Text='<%# Eval("HAmount","{0:N2}") %>' Enabled="false" />
                                            </td>
                                        </tr>
                                        <asp:Panel runat="server" ID="pnlPayMode" Visible='<%# Me.ShwPayMode() %>'>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Bank Charge
                                                </td>
                                                <td class="GridRow1B">
                                                    <asp:TextBox ID="txtBankCharge" runat="server" CssClass="TextBox" Text='<%# Bind("BAmount","{0:F2}") %>' Enabled='<%# Me.CanEdit()%>' />
                                                    <asp:CompareValidator ID="txtBankCharge_CompareValidator" runat="server" ControlToValidate="txtBankCharge"
                                                        Operator="DataTypeCheck" Type="Double" SkinID="skInteger" />
                                                    <asp:ValidatorCalloutExtender ID="txtBankCharge_ValidatorCalloutExtender" runat="server"
                                                        TargetControlID="txtBankCharge_CompareValidator" SkinID="skExtender" />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Pay Mode
                                                </td>
                                                <td class="GridRow1B">
                                                    <asp:DropDownList ID="ddlPayMode" runat="server" AutoPostBack="True" BackColor="White"
                                                        CssClass="TextBox" DataSourceID="dsPayMode" DataTextField="PayModeID" AppendDataBoundItems="true"
                                                        DataValueField="PayModeID" SelectedValue='<%# Bind("PayModeID") %>' >
                                                        <asp:ListItem Value="">-</asp:ListItem>
                                                    </asp:DropDownList>
                                                </td>
                                            </tr>
                                        </asp:Panel>
                                        <asp:Panel runat="server" ID="pnlStatisticE" Visible='<%# Eval("Statistic") %>'>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Nights
                                                </td>
                                                <td class="GridRow1B">
                                                    <asp:TextBox ID="txtNights" runat="server" CssClass="TextBox" Text='<%# Bind("RoomNights") %>' />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Adult Pax
                                                </td>
                                                <td class="GridRow1B">
                                                    <asp:TextBox ID="txtAPax" runat="server" CssClass="TextBox" Text='<%# Bind("AdultPax") %>' />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Child Pax
                                                </td>
                                                <td class="GridRow1B">
                                                    <asp:TextBox ID="txtCPax" runat="server" CssClass="TextBox" Text='<%# Bind("ChildPax") %>' />
                                                </td>
                                            </tr>
                                            <asp:Panel ID="pnlMP" runat="server" Style="height: 100%;" BorderStyle="None" Visible="false">
                                                <tr>
                                                    <td class="GridRowClear">
                                                    </td>
                                                    <td class="GridRowClear">
                                                        <table style="height: 100%;">
                                                            <tr style="height: 100%;">
                                                                <td>
                                                                    <asp:GridView ID="gridMealPlan" runat="server" AllowSorting="True" AutoGenerateColumns="False"
                                                                        DataKeyNames="MealPlanID" DataSourceID="dsMealPlan" SkinID="skGridView" Width="100%"
                                                                        Visible="True">
                                                                        <Columns>
                                                                            <asp:BoundField DataField="HotelId" HeaderText="HotelId" SortExpression="HotelId" ReadOnly="True" Visible="False" />
                                                                            <asp:TemplateField SortExpression="SelectedMP">
                                                                                <ItemTemplate>
                                                                                    <asp:CheckBox ID="CheckBox1" runat="server" Checked='<%# Bind("SelectedMP") %>' Enabled="true" />
                                                                                </ItemTemplate>
                                                                                <EditItemTemplate>
                                                                                    <asp:CheckBox ID="CheckBox1" runat="server" Checked='<%# Bind("SelectedMP") %>' />
                                                                                </EditItemTemplate>
                                                                                <ItemStyle Width="25px" />
                                                                            </asp:TemplateField>
                                                                            <asp:BoundField DataField="MealPlanID" HeaderText="Meal Plan" ReadOnly="True">
                                                                                <HeaderStyle HorizontalAlign="Left" Font-Bold="True" />
                                                                                <ItemStyle Width="100px" />
                                                                            </asp:BoundField>
                                                                        </Columns>
                                                                    </asp:GridView>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td style="height: 30px; text-align: right;">
                                                                    <asp:Button ID="Button7" runat="server" SkinID="skBtnBase" Text="Update" Visible="False" />
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </asp:Panel>
                                        </asp:Panel>
                                        <tr>
                                            <td class="SelectRowClear">
                                                Note
                                            </td>
                                            <td class="GridRowClear">
                                                <asp:TextBox ID="txtNote" runat="server" CssClass="TextBox" TextMode="MultiLine"
                                                    Text='<%# Bind("Note") %>' MaxLength="2000" onkeyup="return checkMaxLen(this,2001)" />
                                                <asp:Label ID="lblCodeE" runat="server" Text='<%# Eval("DocCode") %>' Visible="False" />
                                                <asp:RegularExpressionValidator ID="RegularExpressionValidator2" runat="server" ControlToValidate="txtNote"
                                                    Display="Static" ErrorMessage="Not more than 2000 charcters" ValidationExpression="^[\s\S]{0,2000}$" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="GridRow2T" style="text-align: right; padding-top: 5px;" colspan="2">
                                                <asp:Button ID="Button2" runat="server" SkinID="skBtnBase" Text="Update" CommandName="Update" style="margin-left: 5px;"/>
                                                <asp:Button ID="Button1" runat="server" SkinID="skBtnBase" Text="Cancel" CommandName="Cancel" CausesValidation="False" />
                                            </td>
                                        </tr>
                                    </table>
                                </EditItemTemplate>
                                <ItemTemplate>
                                    <table cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td class="GridRow1B" style="text-align: right; padding-right: 5px;">
                                                <b><asp:Label ID="lbDocument" runat="server" Text='<%# Eval("DocCode") %>' /></b>
                                            </td>
                                            <td class="GridRow1B" >
                                                <b><asp:Label ID="Label1" runat="server" Text='<%# Eval("DocNumber") %>' /></b>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B" style="width: 100px">
                                                Tour Operator
                                            </td>
                                            <td class="GridRow1B" style="width: 380px">
                                                <asp:DropDownList ID="ddlTO" runat="server" CssClass="TextBox" DataSourceID="dsTOAll"
                                                    DataTextField="TourOp" DataValueField="TourOpID" SelectedValue='<%# Bind("TourOpId") %>'
                                                    Enabled="false">
                                                    <asp:ListItem Selected="True">-</asp:ListItem>
                                                </asp:DropDownList>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Department
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:Label ID="lblDep" runat="server" Text='<%# Eval("DepID") %>' Visible="False" />
                                                <asp:DropDownList ID="ddlDep1" runat="server" AppendDataBoundItems="True" 
                                                    BackColor="White" CssClass="TextBox" DataSourceID="dsDep1" DataTextField="DepName"
                                                    DataValueField="DepID" Enabled="False" SelectedValue='<%# Eval("DepID") %>'>
                                                    <asp:ListItem Value="" Selected="True">-</asp:ListItem>
                                                </asp:DropDownList>
                                                <asp:ObjectDataSource ID="dsDep1" runat="server" 
                                                    SelectMethod="GetDataBy" 
                                                    TypeName="dsMaintBasicTableAdapters.DepartmentTableAdapter">
                                                    <SelectParameters>
                                                        <asp:ControlParameter ControlID="lblDep" Name="DepID" PropertyName="Text" Type="Int32" />
                                                    </SelectParameters>
                                                </asp:ObjectDataSource>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Employee
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:Label ID="lblEmp" runat="server" Text='<%# Eval("EmpID") %>' Visible="False" />
                                                <asp:DropDownList ID="ddlEmp" runat="server" BackColor="White" CssClass="TextBox"
                                                    DataSourceID="dsEmp" DataTextField="EmpName" DataValueField="EmpID" Enabled="False"
                                                    AppendDataBoundItems="True" SelectedValue='<%# Eval("EmpID") %>'>
                                                    <asp:ListItem Value=""></asp:ListItem>
                                                </asp:DropDownList>
                                                <asp:ObjectDataSource ID="dsEmp" runat="server" 
                                                    SelectMethod="GetDataByEmp" 
                                                    TypeName="dsMaintBasicTableAdapters.EmployeeTableAdapter">
                                                    <SelectParameters>
                                                        <asp:ControlParameter ControlID="lblEmp" Name="EmpID" PropertyName="Text" Type="Int32" />
                                                    </SelectParameters>
                                                </asp:ObjectDataSource>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Date
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:Label ID="lblDate" runat="server" Text='<%# Eval("DocDate","{0:d}") %>' />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Reference
                                            </td>
                                            <td class="GridRow1B">
                                                <asp:Label ID="lblReference" runat="server" Text='<%# Eval("Reference") %>' />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="SelectRow1B">
                                                Amount
                                            </td>
                                            <td class="GridRow1B">
                                                <%--***Local USD&nbsp;--%>
                                                <asp:Label ID="txtAmount" runat="server" Text='<%# Eval("Amount", "{0:N2}") %>' Font-Bold="true" Width="100px" style="text-align: right;" />
                                                <%--***Local
                                                <br />
                                                <asp:GridView ID="gvExcAmount" runat="server" AutoGenerateColumns="False" 
                                                    DataKeyNames="DocumentID,CurrencyID" DataSourceID="dsExcAmount"
                                                    ShowHeader="false" GridLines="None" >
                                                    <Columns>
                                                        <asp:TemplateField HeaderText="CurrencyID" SortExpression="CurrencyID">
                                                            <ItemTemplate>
                                                                <asp:Label ID="Label1" runat="server" Text='<%# Eval("CurrencyID") %>' />
                                                                <asp:Label ID="Label3" runat="server" Text='<%# Eval("CurrencyAmount", "{0:N2}") %>' Width="100px" style="text-align: right;" />
                                                                &nbsp;
                                                                <asp:Label ID="Label2" runat="server" Text='<%# "(" & Eval("RateExc", "{0:N4}") & ")" %>' Font-Italic="true" />
                                                                &nbsp;
                                                                <asp:Image ID="imgWarning" runat="server" ImageUrl="~/Images/Warning.gif" 
                                                                    Visible='<%# Eval("Valid")=False %>' ToolTip="Applied exchange rate is not valid any more!" />
                                                            </ItemTemplate>
                                                            <ItemStyle CssClass="GridRow1T" />
                                                        </asp:TemplateField>
                                                    </Columns>
                                                </asp:GridView>
                                                <asp:ObjectDataSource ID="dsExcAmount" runat="server" 
                                                    OldValuesParameterFormatString="original_{0}" SelectMethod="GetData" 
                                                    TypeName="AccExchangeTableAdapters.AccTransDocAmountTableAdapter">
                                                    <SelectParameters>
                                                        <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
                                                    </SelectParameters>
                                                </asp:ObjectDataSource>--%>
                                            </td>
                                        </tr>
                                        <asp:Panel runat="server" ID="pnlHCheck" Visible='<%# cbHotel.Checked %>' >
                                            <tr>
                                                <td class="SelectRow1B">
                                                    <asp:Label ID="lblHPercent0" runat="server" Text="Hotel %" />
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblHPercent" runat="server" Text='<%# Eval("HPercent","{0:N2}") %>' />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    <asp:Label ID="lblHPercent1" runat="server" Text="Hotel Amount" />
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblHAmount" runat="server" Text='<%# Eval("HAmount","{0:N2}") %>' />
                                                </td>
                                            </tr>
                                        </asp:Panel> 
                                        <asp:Panel runat="server" ID="pnlPayMode" Visible='<%# Me.ShwPayMode() %>'>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Bank Charge
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblBankCh" runat="server" Text='<%# Eval("BAmount","{0:N2}") %>' />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Pay Mode
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblPayMode" runat="server" Text='<%# Eval("PayModeID") %>' />
                                                </td>
                                            </tr>
                                        </asp:Panel>
                                        <asp:Panel runat="server" ID="pnlStatistic" Visible='<%# Eval("Statistic") %>'>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Nights
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblNights" runat="server" Text='<%# Eval("RoomNights") %>' />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Adult Pax
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblPax" runat="server" Text='<%# Eval("AdultPax") %>' />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="SelectRow1B">
                                                    Child Pax
                                                </td>
                                                <td class="GridRow1B" colspan="2">
                                                    <asp:Label ID="lblChldPax" runat="server" Text='<%# Eval("ChildPax") %>' />
                                                </td>
                                            </tr>
                                            <%--
                                            <tr>
                                                <td class="GridRowClear" style="width: 100px;">
                                                </td>
                                                <td class="GridRowClear" style="width: 300px;">
                                                    <asp:Panel ID="pnlMP" runat="server" Style="height: 100%;" BorderStyle="None">
                                                        <table style="height: 100%;">
                                                            <tr style="height: 100%;">
                                                                <td>
                                                                    <asp:GridView ID="gridMealPlan" runat="server" AllowSorting="True" AutoGenerateColumns="False"
                                                                        DataKeyNames="MealPlanID" DataSourceID="dsMealPlan" SkinID="skGridView" Width="100%"
                                                                        Visible="False">
                                                                        <Columns>
                                                                            <asp:BoundField DataField="HotelId" HeaderText="HotelId" SortExpression="HotelId" ReadOnly="True" Visible="False" />
                                                                            <asp:TemplateField SortExpression="SelectedMP">
                                                                                <ItemTemplate>
                                                                                    <asp:CheckBox ID="CheckBox1" runat="server" Checked='<%# Bind("SelectedMP") %>' Enabled="true" />
                                                                                </ItemTemplate>
                                                                                <EditItemTemplate>
                                                                                    <asp:CheckBox ID="CheckBox1" runat="server" Checked='<%# Bind("SelectedMP") %>' />
                                                                                </EditItemTemplate>
                                                                                <ItemStyle Width="25px" />
                                                                            </asp:TemplateField>
                                                                            <asp:BoundField DataField="MealPlanID" HeaderText="Meal Plan" ReadOnly="True">
                                                                                <HeaderStyle HorizontalAlign="Left" Font-Bold="True" />
                                                                                <ItemStyle Width="100px" />
                                                                            </asp:BoundField>
                                                                        </Columns>
                                                                    </asp:GridView>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td style="height: 30px; text-align: right;">
                                                                    <asp:Button ID="Button7" runat="server" SkinID="skBtnBase" Text="Update" Visible="False" />
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </asp:Panel>
                                                </td>
                                            </tr>
                                            --%></asp:Panel>
                                        <tr>
                                            <td class="SelectRowClear">
                                                Note
                                            </td>
                                            <td class="GridRowClear">
                                                <asp:Label ID="lblNote" runat="server" TextMode="MultiLine" Text='<%# Eval("Note") %>' Width="360px" Visible='<%# Not Eval("Note") Is DBNull.Value %>' />
                                                <asp:Label ID="lblCode" runat="server" Text='<%# Eval("DocCode") %>' Visible="False" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="GridRow2T" style="text-align: left; padding-top: 5px;">
                                                <div class="Red">
                                                    <asp:Button ID="Button3" runat="server" SkinID="skBtnBase" Text="Cancel" OnClientClick="return confirm('Are you sure you want to CANCEL this document?')"
                                                        CommandName="CancelDoc" CommandArgument='<%# Eval("DocumentID") %>' Visible='<%# Me.CanEdit() %>' />
                                                    <asp:Button ID="Button5" runat="server" SkinID="skBtnBase" Text="Uncancel" OnClientClick="return confirm('Are you sure you want to UNCANCEL this document?')"
                                                        CommandName="CancelDoc" CommandArgument='<%# Eval("DocumentID") %>' Visible='False' />
                                                </div>
                                            </td>
                                            <td class="GridRow2T" style="text-align: right; padding-top: 5px;">
                                                <%--<asp:Button ID="btEdit" runat="server" CommandName="Edit" SkinID="skBtnBase" Text='<%# Iif(Me.CanEdit(),"Edit","Modify") %>'
                                                    Visible='<%# Me.CanEdit() Or Me.CanModify() %>' />--%>
                                                <asp:Button ID="btEdit" runat="server" CommandName="Edit" SkinID="skBtnBase" Text="Edit" Visible='<%# Me.CanEdit() %>' />
                                                <asp:Button ID="btModify" runat="server" CommandName="ModifyDoc" SkinID="skBtnBase" Text="Modify" Visible='<%# Not Me.CanEdit() And Me.CanModify() %>' />
                                                <asp:Button ID="btApply" runat="server" SkinID="skBtnBase" Text="Apply" CommandName="ApplyDoc"
                                                    CommandArgument='<%# Eval("DocumentID") %>' Visible='<%# Me.CanApply() %>' Enabled='<%# Master.IsApproved() %>' style="margin-left: 5px;" />
                                                <asp:Button ID="btTransfer" runat="server" SkinID="skBtnBase" Text="Transfer" CommandName="TransferDoc"
                                                    CommandArgument='<%# Eval("DocumentID") %>' Visible='<%# Me.CanApply() %>' Enabled='<%# Master.IsApproved() %>' style="margin-left: 5px;" />
                                            </td>
                                        </tr>
                                    </table>
                                </ItemTemplate>
                            </asp:FormView>
                            <asp:ObjectDataSource ID="dsDep1" runat="server" 
                                SelectMethod="GetData" 
                                TypeName="dsMaintBasicTableAdapters.DepartmentTableAdapter">
                            </asp:ObjectDataSource>
                            <asp:ObjectDataSource ID="dsEmp" runat="server" 
                                SelectMethod="GetDataByDepID" 
                                TypeName="dsMaintBasicTableAdapters.EmployeeTableAdapter">
                                <SelectParameters>
                                    <asp:Parameter Name="DepID" Type="Int32" />
                                </SelectParameters>
                            </asp:ObjectDataSource>
                            <asp:ObjectDataSource ID="dsTOAll" runat="server" 
                                SelectMethod="GetDataByUser" 
                                TypeName="TourOperTableAdapters.TourOpTableAdapter" >
                                <SelectParameters>
                                    <asp:ControlParameter ControlID="hfUsername" Name="User" PropertyName="Value" Type="String" />
                                </SelectParameters>
                            </asp:ObjectDataSource>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <asp:CheckBox ID="cbHotel" runat="server" AutoPostBack="True" Text="Show Htl.Amount" />
                            <asp:CheckBox ID="cbCanceled" runat="server" AutoPostBack="True" Text="Show Cancelled" style="margin-left: 10px;" />
                        </td>
                        <td style="text-align: right;">
                            <asp:Button ID="btnPrintA" runat="server" SkinID="skBtnBase" Text="Report ACCT" />
                            <asp:Button ID="btnPrintT" runat="server" SkinID="skBtnBase" Text="Report Tr" style="margin-left: 5px;" />
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <asp:ObjectDataSource ID="dsAccDocStatus" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="dsAccountingTableAdapters.SelectAccDocStatusTableAdapter">
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
            <asp:ControlParameter ControlID="hfUsername" Name="UserName" PropertyName="Value"
                Type="String" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsAccTransDoc" runat="server" 
        TypeName="dsAccountingTableAdapters.AccTransDocumentTableAdapter" 
        SelectMethod="GetDataByDocID"
        UpdateMethod="Update"
        DeleteMethod="Delete" 
        InsertMethod="Insert">
        <DeleteParameters>
            <asp:Parameter Name="DocumentID" Type="Int32" />
        </DeleteParameters>
        <UpdateParameters>
            <asp:Parameter Name="DocumentID" Type="Int32" />
            <asp:Parameter Name="DocDate" Type="DateTime" />
            <asp:Parameter Name="TourOpId" Type="Int32" />
            <asp:Parameter Name="PayModeID" Type="String" />
            <asp:Parameter Name="Amount" Type="Decimal" />
            <asp:Parameter Name="BAmount" Type="Decimal" />
            <asp:Parameter Name="HAmount" Type="Decimal" />
            <asp:Parameter Name="HPercent" Type="Decimal" />
            <asp:Parameter Name="Reference" Type="String" />
            <asp:Parameter Name="Note" Type="String" />
            <asp:ControlParameter ControlID="hfUser" Name="UserName" PropertyName="Value" Type="String" />
            <asp:Parameter Name="DepID" Type="Int32" />
            <asp:Parameter Name="EmpID" Type="Int32" />
            <asp:Parameter Name="RoomNights" Type="Int32" />
            <asp:Parameter Name="AdultPax" Type="Int32" />
            <asp:Parameter Name="ChildPax" Type="Int32" />
            <asp:Parameter Name="MealPlan" Type="String" />
        </UpdateParameters>
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
        </SelectParameters>
        <InsertParameters>
            <asp:Parameter Name="DocCode" Type="String" />
            <asp:Parameter Name="DocNumber" Type="Int32" />
            <asp:Parameter Name="DocOrd" Type="Int32" />
            <asp:Parameter Name="TourOpId" Type="Int32" />
            <asp:Parameter Name="HotelId" Type="Int32" />
            <asp:Parameter Name="PayModeID" Type="String" />
            <asp:Parameter Name="Amount" Type="Decimal" />
            <asp:Parameter Name="BAmount" Type="Decimal" />
            <asp:Parameter Name="HAmount" Type="Decimal" />
            <asp:Parameter Name="HPercent" Type="Decimal" />
            <asp:Parameter Name="DocDate" Type="DateTime" />
            <asp:Parameter Name="UserName" Type="String" />
            <asp:Parameter Name="Canceled" Type="Boolean" />
            <asp:Parameter Name="ExtDocID" Type="Int32" />
            <asp:Parameter Name="TransDocID" Type="Int32" />
            <asp:Parameter Name="Reference" Type="String" />
            <asp:Parameter Name="Note" Type="String" />
            <asp:Parameter Name="DepID" Type="Int32" />
            <asp:Parameter Name="EmpID" Type="Int32" />
            <asp:Parameter Name="RoomNights" Type="Int32" />
            <asp:Parameter Name="AdultPax" Type="Int32" />
            <asp:Parameter Name="ChildPax" Type="Int32" />
            <asp:Parameter Name="MealPlanID" Type="String" />
        </InsertParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsAccTransDocMaster" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="dsAccountingTableAdapters.AccTransDocumentMasterTableAdapter" >
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsPayMode" runat="server" OldValuesParameterFormatString="original_{0}" 
        SelectMethod="GetData" TypeName="TourOperTableAdapters.PayModeTableAdapter">
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsAppStatus" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="dsAccountingTableAdapters.SelectAccDocStatusTableAdapter">
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
            <asp:ControlParameter ControlID="hfUsername" Name="UserName" PropertyName="Value" Type="String" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsApplications" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="AccDocApplicationTableAdapters.SelectAccDocApplTableAdapter">
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
            <asp:ControlParameter ControlID="cbCanceled" DefaultValue="" Name="ShowCancel" PropertyName="Checked" Type="Boolean" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsTransactionsRpt" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="AccDocApplicationTableAdapters.RptTransferDetailTableAdapter">
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
            <asp:ControlParameter ControlID="cbCanceled" Name="ShowCancel" PropertyName="Checked" Type="String" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsDocHeader" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="dsAccountingTableAdapters.DocHeaderTableAdapter">
        <SelectParameters>
            <asp:QueryStringParameter Name="DocumentID" QueryStringField="DocumentID" Type="Int32" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsMealPlan" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetData" TypeName="dsMaintHotelTableAdapters.SelectHotelMealPlanTableAdapter">
        <SelectParameters>
            <asp:Parameter Name="HotelID" Type="Int32" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsStatistic" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetDataByCode" TypeName="dsAccountTableAdapters.AccDocumentTableAdapter">
        <SelectParameters>
            <asp:Parameter Name="TrCode" Type="String" />
        </SelectParameters>
    </asp:ObjectDataSource>
    <asp:ObjectDataSource ID="dsStatistic0" runat="server" OldValuesParameterFormatString="original_{0}"
        SelectMethod="GetDataByCode" TypeName="dsAccountTableAdapters.AccDocumentTableAdapter">
        <SelectParameters>
            <asp:Parameter Name="TrCode" Type="String" />
        </SelectParameters>
    </asp:ObjectDataSource>
    

    <asp:UpdatePanel runat="server" ID="UpdatePanel1" UpdateMode="Always" >
        <ContentTemplate>

    <asp:HiddenField ID="dummy" runat="server" />
    <asp:ModalPopupExtender ID="popExtender" runat="server" PopupControlID="popPanel"
        CancelControlID="btnNo" OkControlID="btnYes" DropShadow="True" Enabled="True"
        BackgroundCssClass="modalBackground" X="200" Y="200" TargetControlID="dummy">
    </asp:ModalPopupExtender>
    <asp:Panel ID="popPanel" runat="server" Width="300px" BackColor="White" Style="display: none">
        <table cellpadding="0" cellspacing="0" style="width: 100%;">
            <tr>
                <td class="GridLabelBG">
                    <asp:Label ID="popLabel" runat="server" Text="Delete data" SkinID="skGridLabel"></asp:Label>
                </td>
            </tr>
            <tr>
                <td class="GridBorder">
                    <p style="text-align: center;">
                        <asp:Label ID="popMessage" runat="server" Text="Message"></asp:Label>
                    </p>
                    <p style="text-align: right;" >
                        <br />
                        <asp:Button ID="btnYes" runat="server" Text="Yes" SkinID="skBtnBase" />&nbsp;
                        <asp:Button ID="btnNo" runat="server" Text="No" SkinID="skBtnBase" />&nbsp;
                    </p>
                </td>
            </tr>
        </table>
    </asp:Panel>

        <%--</ContentTemplate>
    </asp:UpdatePanel>--%>
        </ContentTemplate>
    </asp:UpdatePanel>

</asp:Content>
